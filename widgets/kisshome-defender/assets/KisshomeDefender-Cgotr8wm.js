import{j as e}from"./jsx-runtime-DgV-aPJi.js";import{k as i}from"./kisshome_mf_2_defender__loadShare___mf_0_mui_mf_1_material__loadShare__-D3dMW-x_.js";import{k as l,i as c}from"./kisshome_mf_2_defender__mf_v__runtimeInit__mf_v__-BU_gO0Ez.js";import{k as r}from"./kisshome_mf_2_defender__loadShare__react__loadShare__-BuzZmBs-.js";import"./_commonjsHelpers-Cpj98o6Y.js";const m=""+new URL("kisshome-defender-Thki-JWA.svg",import.meta.url).href,{loadShare:f}=c,{initPromise:v}=l,p=v.then(o=>f("@iobroker/adapter-react-v5",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),g=await p.then(o=>o());var a=g;class u extends r.Component{constructor(s){super(s),this.state={demo:"demo"}}render(){return e.jsxs("div",{className:"status-tab",children:[e.jsx("h2",{children:"Status"}),e.jsx("p",{children:"All systems operational."})]})}}class S extends r.Component{constructor(s){super(s),this.state={demo:"demo"}}render(){return e.jsxs("div",{className:"status-tab",children:[e.jsx("h2",{children:"Status"}),e.jsx("p",{children:"All systems operational."})]})}}class x extends r.Component{constructor(s){super(s),this.state={demo:"demo"}}render(){return e.jsxs("div",{className:"status-tab",children:[e.jsx("h2",{children:"Status"}),e.jsx("p",{children:"All systems operational."})]})}}class y extends r.Component{constructor(s){super(s),this.state={initialConfig:null,newConfig:null,adminLink:"",enabled:!1}}async findAdminLink(s){const t=await this.props.context.socket.getAdapterInstances("admin");let n=t.find(d=>d.common.enabled&&d.common.host===s);return n||=t.find(d=>d.common.enabled),n||=t[0],n?`http${n.native.secure?"s":""}://${n.common.host===s?window.location.hostname:n.common.host}:${n.native.port}/#tab-instances/config/system.adapter.kisshome-defender.${this.props.instance}/_instances`:""}async componentDidMount(){const s=await this.props.context.socket.getObject(`system.adapter.kisshome-defender.${this.props.instance}`),t=await this.props.context.socket.getState(`kisshome-defender.${this.props.instance}.info.recording.enabled`);s!=null&&s.native?this.setState({enabled:!!(t!=null&&t.val),initialConfig:{anomalySensitivity:s.native.anomalySensitivity||"medium",saveThresholdSeconds:s.native.saveThresholdSeconds||60},newConfig:{anomalySensitivity:s.native.anomalySensitivity||"medium",saveThresholdSeconds:s.native.saveThresholdSeconds||60},adminLink:await this.findAdminLink(s.common.host)}):console.error("Failed to load adapter configuration"),await this.props.context.socket.subscribeObject(`system.adapter.kisshome-defender.${this.props.instance}`,this.onSettingsChanged),await this.props.context.socket.subscribeState(`kisshome-defender.${this.props.instance}.info.recording.enabled`,this.onRunningChanged)}componentWillUnmount(){this.props.context.socket.unsubscribeObject(`system.adapter.kisshome-defender.${this.props.instance}`,this.onSettingsChanged),this.props.context.socket.unsubscribeState(`kisshome-defender.${this.props.instance}.info.recording.enabled`,this.onRunningChanged)}onRunningChanged=(s,t)=>{s===`kisshome-defender.${this.props.instance}.info.recording.enabled`&&!!(t!=null&&t.val)!==this.state.enabled&&this.setState({enabled:!!(t!=null&&t.val)})};onSettingsChanged=(s,t)=>{s===`system.adapter.kisshome-defender.${this.props.instance}`&&(t!=null&&t.native)&&(!this.state.initialConfig||this.state.initialConfig.saveThresholdSeconds!==(t.native.saveThresholdSeconds||"medium")||this.state.initialConfig.anomalySensitivity!==(t.native.anomalySensitivity||60))&&this.setState({initialConfig:{anomalySensitivity:t.native.anomalySensitivity||"medium",saveThresholdSeconds:t.native.saveThresholdSeconds||60},newConfig:{anomalySensitivity:t.native.anomalySensitivity||"medium",saveThresholdSeconds:t.native.saveThresholdSeconds||60}})};render(){if(!this.state.initialConfig||!this.state.newConfig)return e.jsx(i.LinearProgress,{});const s=this.state.newConfig.saveThresholdSeconds!==this.state.initialConfig.saveThresholdSeconds||this.state.newConfig.anomalySensitivity!==this.state.initialConfig.anomalySensitivity;return e.jsxs(i.Paper,{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[this.state.adminLink?e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:250},children:a.I18n.t("Manage monitored devices")}),e.jsx(i.Link,{href:this.state.adminLink,target:"settings"})]}):null,e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:250},children:a.I18n.t("Protection enabled")}),e.jsx(i.Switch,{checked:this.state.enabled,onChange:async(t,n)=>{await this.props.context.socket.setState(`kisshome-defender.${this.props.instance}.info.recording.enabled`,n)}})]}),e.jsxs("div",{style:{width:"100%",display:"flex"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:250},children:a.I18n.t("Save threshold in seconds")}),e.jsx(i.Slider,{style:{flexGrow:1},min:2,max:60,value:this.state.newConfig.saveThresholdSeconds,onChange:(t,n)=>{this.setState({newConfig:{anomalySensitivity:this.state.newConfig.anomalySensitivity,saveThresholdSeconds:n}})}})]}),e.jsxs("div",{style:{width:"100%",display:"flex"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:250},children:a.I18n.t("Anomaly sensitivity")}),e.jsxs(i.Select,{value:this.state.newConfig.anomalySensitivity||"medium",onChange:t=>this.setState({newConfig:{anomalySensitivity:t.target.value,saveThresholdSeconds:this.state.newConfig.saveThresholdSeconds}}),children:[e.jsx(i.MenuItem,{value:"low",children:a.I18n.t("Low")}),e.jsx(i.MenuItem,{value:"medium",children:a.I18n.t("Medium")}),e.jsx(i.MenuItem,{value:"high",children:a.I18n.t("High")})]})]}),s?e.jsx("div",{style:{width:"100%"},children:e.jsx(i.Button,{variant:"contained",color:"primary",onClick:async()=>{const t=await this.props.context.socket.getObject(`system.adapter.kisshome-defender.${this.props.instance}`);this.setState({initialConfig:{anomalySensitivity:this.state.newConfig.anomalySensitivity,saveThresholdSeconds:this.state.newConfig.saveThresholdSeconds}},()=>{t.native.anomalySensitivity=this.state.newConfig.anomalySensitivity,t.native.saveThresholdSeconds=this.state.newConfig.saveThresholdSeconds,this.props.context.socket.setObject(`system.adapter.kisshome-defender.${this.props.instance}`,t)})},children:a.I18n.t("Apply new settings")})}):null]})}}class h extends window.visRxWidget{constructor(s){super(s),this.state={...this.state,tab:window.localStorage.getItem("kisshome-defender-tab")||"status"}}static getWidgetInfo(){return{id:"tplKisshomeDefender",visSet:"kisshome-defender",visSetLabel:"set_label",visSetColor:"#ff9c2c",visWidgetLabel:"KISShome",visName:"KisshomeDefender",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"kisshome-defender",isShort:!0,default:"0"}]}],visDefaultStyle:{width:"100%",height:185,position:"relative"},visPrev:"widgets/kisshome-defender/img/prev_kisshome-defender.png"}}getWidgetInfo(){return h.getWidgetInfo()}renderWidgetBody(s){return super.renderWidgetBody(s),e.jsxs(i.Card,{style:{width:"100%",height:"100%"},children:[e.jsxs(i.Toolbar,{variant:"dense",style:{width:"100%",display:"flex"},children:[e.jsx("img",{src:m,style:{height:"100%",marginRight:8,marginLeft:8},alt:"KISShome Defender"}),e.jsxs(i.Tabs,{style:{flexGrow:1},value:this.state.tab||"status",onChange:(t,n)=>{this.setState({tab:n}),window.localStorage.setItem("kisshome-defender-tab",n)},children:[e.jsx(i.Tab,{value:"status",label:a.I18n.t("Status")}),e.jsx(i.Tab,{value:"statistics",label:a.I18n.t("Statistics")}),e.jsx(i.Tab,{value:"detections",label:a.I18n.t("Detections")}),e.jsx("div",{style:{flexGrow:1}}),e.jsx(i.Tab,{value:"settings",label:a.I18n.t("Settings")})]})]}),e.jsxs("div",{style:{width:"100%",height:"calc(100% - 48px)"},children:[this.state.tab==="status"?e.jsx(u,{instance:this.state.rxData.instance,context:this.props.context}):null,this.state.tab==="statistics"?e.jsx(S,{instance:this.state.rxData.instance,context:this.props.context}):null,this.state.tab==="detections"?e.jsx(x,{instance:this.state.rxData.instance,context:this.props.context}):null,this.state.tab==="settings"?e.jsx(y,{instance:this.state.rxData.instance,context:this.props.context}):null]})]})}}export{h as default};
